<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T·∫æT NGUY√äN ƒê√ÅN 2026 - CH√âM HOA QU·∫¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Gi·ªØ nguy√™n t·∫•t c·∫£ CSS hi·ªán c√≥ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-red: #D42426;
            --gold: #FDB913;
            --dark-red: #8B0000;
            --light-gold: #FFD700;
            --bg-gradient: linear-gradient(135deg, #9B1D1D 0%, #5C0A0A 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 215, 0, 0.3);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-gradient);
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Decoration Elements */
        .lantern {
            position: fixed;
            width: 60px;
            height: 80px;
            background: var(--primary-red);
            border-radius: 30px 30px 10px 10px;
            box-shadow: 0 0 20px rgba(253, 185, 19, 0.5);
            z-index: 0;
        }

        .lantern::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 20px;
            width: 20px;
            height: 15px;
            background: var(--gold);
            border-radius: 5px;
        }

        .lantern.left { left: 20px; top: 20px; }
        .lantern.right { right: 20px; top: 20px; }
        .lantern:after {
            content: 'üéã';
            position: absolute;
            bottom: -25px;
            left: 20px;
            font-size: 20px;
        }

        /* Screens */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 10;
            backdrop-filter: blur(5px);
        }

        .screen.active {
            display: flex;
            animation: fadeInScale 0.5s ease;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Glass Card */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            border-radius: 30px;
            padding: 35px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            animation: float 3s ease-in-out infinite;
            z-index: 20;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(253,185,19,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Typography */
        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--gold), #FFE55C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        h2 {
            font-size: 1.8rem;
            color: var(--gold);
            margin-bottom: 20px;
        }

        h3 {
            font-size: 1.2rem;
            color: var(--light-gold);
            margin-bottom: 10px;
        }

        /* Forms */
        .input-group {
            margin-bottom: 20px;
            text-align: left;
            position: relative;
            z-index: 30;
        }

        .input-group label {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--gold);
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--gold);
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.02);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--gold);
        }

        .checkbox-group label {
            color: var(--gold);
            cursor: pointer;
            font-size: 0.95rem;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 15px;
            border: none;
            background: linear-gradient(135deg, var(--gold), #FDB913);
            color: var(--dark-red);
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer !important;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            z-index: 40;
            margin-bottom: 10px;
            pointer-events: auto !important;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
            z-index: -1;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--gold);
            color: var(--gold);
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--gold);
            font-size: 0.95rem;
            margin-top: 15px;
            cursor: pointer !important;
            text-decoration: underline;
            width: auto;
            display: inline-block;
            pointer-events: auto !important;
            z-index: 40;
        }

        .btn-link:hover {
            color: #fff;
        }

        /* Game Canvas */
        #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="12" fill="none" stroke="%23FDB913" stroke-width="3"/><line x1="4" y1="4" x2="12" y2="12" stroke="%23FDB913" stroke-width="3"/><line x1="28" y1="4" x2="20" y2="12" stroke="%23FDB913" stroke-width="3"/><line x1="4" y1="28" x2="12" y2="20" stroke="%23FDB913" stroke-width="3"/><line x1="28" y1="28" x2="20" y2="20" stroke="%23FDB913" stroke-width="3"/></svg>') 16 16, crosshair;
        }

        /* Game HUD */
        .game-hud {
            position: fixed;
            top: 20px;
            left: 0;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            z-index: 5;
            pointer-events: none;
        }

        .hud-item {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 12px 25px;
            border-radius: 40px;
            border: 2px solid var(--gold);
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hud-item i {
            color: var(--gold);
            font-size: 1.3rem;
        }

        /* Pause Menu */
        .pause-menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--gold);
            border-radius: 30px;
            padding: 30px;
            z-index: 100;
            display: none;
            flex-direction: column;
            gap: 15px;
            min-width: 300px;
            box-shadow: var(--shadow);
        }

        .pause-menu.active {
            display: flex;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .pause-btn {
            padding: 15px;
            border-radius: 15px;
            border: none;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pause-btn.resume {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .pause-btn.quit {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .pause-btn:hover {
            transform: scale(1.05);
        }

        /* Countdown Timer */
        .countdown {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(253,185,19,0.5);
            margin: 20px 0;
        }

        /* Leaderboard */
        .rank-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            padding: 10px;
        }

        .rank-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            transition: all 0.3s;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .rank-item:hover {
            transform: scale(1.02);
            background: rgba(255, 215, 0, 0.2);
        }

        .rank-gold {
            background: linear-gradient(135deg, rgba(253,185,19,0.3), rgba(255,215,0,0.1));
            border: 1px solid var(--gold);
        }

        .rank-number {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--gold);
            color: var(--dark-red);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            margin-right: 15px;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #9B1D1D, #5C0A0A);
            padding: 35px;
            border-radius: 30px;
            max-width: 500px;
            width: 90%;
            border: 3px solid var(--gold);
            animation: modalPop 0.4s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes modalPop {
            from {
                opacity: 0;
                transform: scale(0.7);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Toast */
        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold);
            color: var(--dark-red);
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 700;
            z-index: 2000;
            display: none;
            box-shadow: var(--shadow);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        /* Tet Wishes */
        .tet-wish {
            font-size: 1.2rem;
            color: var(--gold);
            font-style: italic;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 10px var(--gold); }
            50% { text-shadow: 0 0 20px var(--gold); }
        }

        /* Loading Spinner */
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(253,185,19,0.3);
            border-top: 5px solid var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Game Over Screen */
        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 3px solid var(--gold);
            border-radius: 30px;
            padding: 40px;
            z-index: 200;
            text-align: center;
            min-width: 320px;
        }

        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 3rem;
            color: var(--gold);
            font-weight: 800;
            margin: 20px 0;
        }

        /* Fireworks */
        .firework {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
        }

        /* Tutorial Steps */
        .tutorial-step {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            border-left: 4px solid var(--gold);
        }

        .step-icon {
            width: 50px;
            height: 50px;
            background: var(--gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--dark-red);
            font-weight: 800;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            color: var(--gold);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .step-content p {
            font-size: 0.95rem;
            color: rgba(255,255,255,0.9);
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .glass-card { padding: 25px; }
            .hud-item { padding: 8px 15px; font-size: 1rem; }
            .lantern { display: none; }
        }

        /* Welcome Message Animation */
        .welcome-message {
            text-align: center;
            margin: 20px 0;
            font-size: 1.3rem;
            animation: slideInDown 0.8s ease;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Sound Toggle Button */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 2px solid var(--gold);
            color: var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s;
        }

        .sound-toggle:hover {
            transform: scale(1.1);
            background: var(--gold);
            color: var(--dark-red);
        }

        .sound-toggle.muted {
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Decoration -->
    <div class="lantern left"></div>
    <div class="lantern right"></div>

    <!-- Toast -->
    <div id="toast"></div>

    <!-- Sound Toggle Button -->
    <div class="sound-toggle" id="soundToggle" onclick="toggleSound()">
        <i class="fas fa-volume-up"></i>
    </div>

    <!-- Audio Elements -->
    <audio id="bgMusic" loop preload="auto">
        <source src="https://raw.githubusercontent.com/adhsvshsjvdhdhdbjdbdb/web/refs/heads/Gr/nhac.mp3" type="audio/mpeg">
    </audio>
    <audio id="sliceSound" preload="auto">
        <source src="https://raw.githubusercontent.com/adhsvshsjvdhdhdbjdbdb/web/refs/heads/Gr/hoaqua.mp3" type="audio/mpeg">
    </audio>
    <audio id="bombSound" preload="auto">
        <source src="https://raw.githubusercontent.com/adhsvshsjvdhdhdbjdbdb/web/refs/heads/Gr/bom.mp3" type="audio/mpeg">
    </audio>
    <audio id="giftSound" preload="auto">
        <source src="https://raw.githubusercontent.com/adhsvshsjvdhdhdbjdbdb/web/refs/heads/Gr/chucmung.mp3" type="audio/mpeg">
    </audio>
    <audio id="loseSound" preload="auto">
        <source src="https://raw.githubusercontent.com/adhsvshsjvdhdhdbjdbdb/web/refs/heads/Gr/thua.mp3" type="audio/mpeg">
    </audio>

    <!-- Pause Menu -->
    <div id="pauseMenu" class="pause-menu">
        <h2 style="color: var(--gold); text-align: center;">‚è∏ T·∫†M D·ª™NG</h2>
        <p style="text-align: center; margin-bottom: 10px;">ƒêi·ªÉm hi·ªán t·∫°i: <span id="pause-score" style="color: var(--gold); font-weight: 800;">0</span></p>
        <button class="pause-btn resume" onclick="resumeGame()">
            <i class="fas fa-play"></i> CH∆†I TI·∫æP
        </button>
        <button class="pause-btn quit" onclick="quitGame()">
            <i class="fas fa-stop"></i> D·ª™NG L·∫†I
        </button>
    </div>

    <!-- Loading Screen -->
    <div id="screen-loading" class="screen active">
        <div class="glass-card">
            <div class="spinner"></div>
            <h1>CH√ÄO XU√ÇN 2026</h1>
            <p style="margin: 20px 0;">ƒêang chu·∫©n b·ªã kh√¥ng kh√≠ T·∫øt...</p>
            <div class="countdown" id="countdown-timer">--:--:--</div>
            <p>üéã S·ª± ki·ªán k·∫øt th√∫c: 18/02/2026</p>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="screen-welcome" class="screen">
        <div class="glass-card">
            <h1>üßß CH√ÄO M·ª™NG üßß</h1>
            <div class="tet-wish" id="welcome-wish">
                üéã Ch√∫c b·∫°n nƒÉm m·ªõi an khang th·ªãnh v∆∞·ª£ng!
            </div>
            <div class="welcome-message">
                <p>üåü TR√í CH∆†I ƒÇN HOA QU·∫¢ T·∫æT 2026 üåü</p>
                <p style="font-size: 1rem; margin-top: 15px;">ƒÇn hoa qu·∫£ nh·∫≠n ƒëi·ªÉm - Rinh qu√† Capcut Pro</p>
            </div>
            <div style="margin: 20px 0;">
                <button class="btn" onclick="showTutorial()">
                    <i class="fas fa-book"></i> H∆Ø·ªöNG D·∫™N CH∆†I
                </button>
                <button class="btn btn-outline" onclick="goToAuth()">
                    <i class="fas fa-sign-in-alt"></i> B·∫ÆT ƒê·∫¶U NGAY
                </button>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="modal-tutorial" class="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 style="color: var(--gold); text-align: center;">üìñ H∆Ø·ªöNG D·∫™N CH∆†I</h2>
            
            <div class="tutorial-step">
                <div class="step-icon">1</div>
                <div class="step-content">
                    <h4>ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</h4>
                    <p>T·∫°o t√†i kho·∫£n (gi·ªõi h·∫°n 50 ng∆∞·ªùi) ho·∫∑c ƒëƒÉng nh·∫≠p ƒë·ªÉ b·∫Øt ƒë·∫ßu ch∆°i</p>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="step-icon">2</div>
                <div class="step-content">
                    <h4>ƒÇn hoa qu·∫£</h4>
                    <p>Di chuy·ªÉn chu·ªôt nh·∫•n ƒë·ªÉ ƒÉn c√°c lo·∫°i qu·∫£ bay l√™n</p>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="step-icon">3</div>
                <div class="step-content">
                    <h4>T√≠nh ƒëi·ªÉm</h4>
                    <p>üçé Hoa qu·∫£: +5 ƒëi·ªÉm<br>üí£ Bom: -10 ƒëi·ªÉm<br>üéÅ Qu√† ƒë·∫∑c bi·ªát: Nh·∫≠n l·ªùi ch√∫c may m·∫Øn</p>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="step-icon">4</div>
                <div class="step-content">
                    <h4>Th·ªùi gian</h4>
                    <p>M·ªói l∆∞·ª£t ch∆°i 10 ph√∫t. ƒê·ªô kh√≥ tƒÉng d·∫ßn theo th·ªùi gian</p>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="step-icon">5</div>
                <div class="step-content">
                    <h4>Gi·∫£i th∆∞·ªüng</h4>
                    <p>Top 3 chung cu·ªôc nh·∫≠n Capcut Pro:<br>ü•á Nh·∫•t: 35 ng√†y<br>ü•à Nh√¨: 14 ng√†y<br>ü•â Ba: 14 ng√†y</p>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <p style="font-style: italic; color: var(--gold);">üéã M·∫πo: T·∫≠p trung ch√©m v√†o gi·ªØa m√†n h√¨nh ƒë·ªÉ d·ªÖ tr√∫ng nh·∫•t!</p>
            </div>

            <button class="btn" onclick="document.getElementById('modal-tutorial').style.display='none'" style="margin-top: 20px;">
                <i class="fas fa-check"></i> ƒê√É HI·ªÇU
            </button>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="screen-auth" class="screen">
        <div class="glass-card" id="login-box">
            <h1>ƒêƒÇNG NH·∫¨P</h1>
            <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi T·∫øt Nguy√™n ƒê√°n 2026</p>
            
            <div class="input-group">
                <label><i class="fas fa-user"></i> T√†i kho·∫£n</label>
                <input type="text" id="l-user" placeholder="Nh·∫≠p t√†i kho·∫£n">
            </div>
            
            <div class="input-group">
                <label><i class="fas fa-lock"></i> M·∫≠t kh·∫©u</label>
                <input type="password" id="l-pass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="remember-me" checked>
                <label for="remember-me">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
            </div>

            <button class="btn" onclick="handleLogin()">
                <i class="fas fa-sign-in-alt"></i> V√ÄO CH∆†I
            </button>
            
            <button class="btn-link" onclick="toggleAuth(true)">
                <i class="fas fa-user-plus"></i> Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω ngay
            </button>
        </div>

        <div class="glass-card" id="reg-box" style="display: none;">
            <h1>ƒêƒÇNG K√ù</h1>
            <p>üéÅ Gi·ªõi h·∫°n 50 t√†i kho·∫£n duy nh·∫•t</p>
            
            <div class="input-group">
                <label><i class="fas fa-user"></i> T√†i kho·∫£n</label>
                <input type="text" id="r-user" placeholder="Ch·ªçn t√™n t√†i kho·∫£n">
            </div>
            
            <div class="input-group">
                <label><i class="fas fa-envelope"></i> Email</label>
                <input type="email" id="r-email" placeholder="Nh·∫≠p email">
            </div>
            
            <div class="input-group">
                <label><i class="fas fa-lock"></i> M·∫≠t kh·∫©u</label>
                <input type="password" id="r-pass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
            </div>

            <button class="btn" onclick="handleRegister()">
                <i class="fas fa-check-circle"></i> T·∫†O T√ÄI KHO·∫¢N
            </button>
            
            <button class="btn-link" onclick="toggleAuth(false)">
                <i class="fas fa-sign-in-alt"></i> ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p
            </button>
        </div>
    </div>

    <!-- Home Screen -->
    <div id="screen-home" class="screen">
        <div class="glass-card">
            <h1>üèÆ XU√ÇN ƒê·∫ÆC L·ªòC üèÆ</h1>
            <div style="margin: 20px 0;">
                <p><i class="fas fa-user"></i> <span id="user-welcome">Kh√°ch</span></p>
                <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                    <div>
                        <h3>üèÜ H·∫°ng</h3>
                        <p id="my-rank" style="font-size: 1.5rem; color: var(--gold);">--</p>
                    </div>
                    <div>
                        <h3>üéØ ƒêi·ªÉm</h3>
                        <p id="my-score" style="font-size: 1.5rem; color: var(--gold);">0</p>
                    </div>
                </div>
            </div>

            <button class="btn" onclick="startGame()" id="btn-play">
                <i class="fas fa-play"></i> B·∫ÆT ƒê·∫¶U ƒÇN(10 PH√öT)
            </button>
            
            <button class="btn btn-outline" onclick="showLeaderboard()" style="margin-top: 10px;">
                <i class="fas fa-trophy"></i> B·∫¢NG X·∫æP H·∫†NG
            </button>
            
            <button class="btn btn-outline" onclick="showTutorial()" style="margin-top: 10px;">
                <i class="fas fa-question-circle"></i> H∆Ø·ªöNG D·∫™N
            </button>
            
            <button class="btn btn-outline" onclick="checkReward()" style="margin-top: 10px; background: linear-gradient(135deg, #D42426, #8B0000); color: var(--gold);">
                <i class="fas fa-gift"></i> PH·∫¶N TH∆Ø·ªûNG
            </button>
            
            <button class="btn-link" onclick="logout()" style="margin-top: 10px;">
                <i class="fas fa-sign-out-alt"></i> ƒêƒÇNG XU·∫§T
            </button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="screen-game" class="screen">
        <div class="game-hud">
            <div class="hud-item">
                <i class="fas fa-star"></i>
                <span id="live-score">0</span>
            </div>
            <div class="hud-item">
                <i class="fas fa-clock"></i>
                <span id="live-time">10:00</span>
            </div>
            <div class="hud-item" onclick="togglePause()" style="cursor: pointer; pointer-events: auto;">
                <i class="fas fa-pause"></i>
            </div>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="game-over" style="display: none;">
        <h2>üèÅ K·∫æT TH√öC</h2>
        <p>ƒêi·ªÉm s·ªë c·ªßa b·∫°n:</p>
        <div class="score-display" id="final-score">0</div>
        <p id="game-over-message"></p>
        <button class="btn" onclick="backToHome()" style="margin-top: 20px;">
            <i class="fas fa-home"></i> V·ªÄ TRANG CH·ª¶
        </button>
    </div>

    <!-- Leaderboard Modal -->
    <div id="modal-rank" class="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2>üèÜ B·∫¢NG V√ÄNG üèÜ</h2>
            <div id="rank-list" class="rank-list"></div>
            <button class="btn" onclick="document.getElementById('modal-rank').style.display='none'">
                <i class="fas fa-times"></i> ƒê√ìNG
            </button>
        </div>
    </div>

    <!-- Reward Modal -->
    <div id="modal-reward" class="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 id="reward-title">üéÅ PH·∫¶N TH∆Ø·ªûNG</h2>
            <div id="reward-content" style="margin: 20px 0; line-height: 1.8;"></div>
            <button class="btn" onclick="document.getElementById('modal-reward').style.display='none'">
                <i class="fas fa-check"></i> X√ÅC NH·∫¨N
            </button>
        </div>
    </div>

    <script>
        // ========== AUDIO CONFIGURATION ==========
        let soundEnabled = true;
        let bgMusic = document.getElementById('bgMusic');
        let sliceSound = document.getElementById('sliceSound');
        let bombSound = document.getElementById('bombSound');
        let giftSound = document.getElementById('giftSound');
        let loseSound = document.getElementById('loseSound');

        // ========== TH√äM: H√†m ph√°t nh·∫°c n·ªÅn khi b·∫Øt ƒë·∫ßu ch√©m ==========
        function playBackgroundMusic() {
            if (soundEnabled && !gamePaused && gameActive) {
                bgMusic.loop = true; // ƒê·∫£m b·∫£o l·∫∑p l·∫°i
                bgMusic.play().catch(e => {
                    console.log("Kh√¥ng th·ªÉ ph√°t nh·∫°c:", e);
                });
            }
        }

        // ========== TH√äM: H√†m d·ª´ng nh·∫°c n·ªÅn ==========
        function stopBackgroundMusic() {
            bgMusic.pause();
            bgMusic.currentTime = 0; // Reset v·ªÅ ƒë·∫ßu
        }

        // ========== TH√äM: X·ª≠ l√Ω khi tho√°t web ==========
        window.addEventListener('beforeunload', function() {
            stopBackgroundMusic();
        });

        window.addEventListener('pagehide', function() {
            stopBackgroundMusic();
        });

        // Toggle √¢m thanh
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const toggleBtn = document.getElementById('soundToggle');
            const icon = toggleBtn.querySelector('i');
            
            if (soundEnabled) {
                icon.className = 'fas fa-volume-up';
                // N·∫øu ƒëang trong game, ph√°t l·∫°i nh·∫°c
                if (gameActive && !gamePaused) {
                    playBackgroundMusic();
                }
            } else {
                icon.className = 'fas fa-volume-mute';
                bgMusic.pause();
            }
        }

        // Ph√°t √¢m thanh khi ch√©m
        function playSliceSound(type) {
            if (!soundEnabled) return;
            
            if (type === 'fruit') {
                sliceSound.currentTime = 0;
                sliceSound.play().catch(e => console.log("Sound error:", e));
            } else if (type === 'bomb') {
                bombSound.currentTime = 0;
                bombSound.play().catch(e => console.log("Sound error:", e));
            } else if (type === 'gift') {
                giftSound.currentTime = 0;
                giftSound.play().catch(e => console.log("Sound error:", e));
            }
        }

        // Ph√°t √¢m thanh thua cu·ªôc
        function playLoseSound() {
            if (soundEnabled) {
                loseSound.currentTime = 0;
                loseSound.play().catch(e => console.log("Sound error:", e));
            }
        }

        // ========== CONFIGURATION ==========
        const REPO = "levietdaithang123/loginvn";
        const TOKEN = "glpat-ir_pXKcHdta5aeo6Quxf9m86MQp1OmtvNWZ3Cw.01.121vv6cl7";
        const FILE = "Key.json";
        const API = `https://gitlab.com/api/v4/projects/${encodeURIComponent(REPO)}/repository/files/${encodeURIComponent(FILE)}`;
        const DEADLINE = new Date("2026-02-18T23:59:59").getTime();

        // L·ªùi ch√∫c T·∫øt ng·∫´u nhi√™n
        const TET_WISHES = [
            "üéã Ch√∫c b·∫°n nƒÉm m·ªõi an khang th·ªãnh v∆∞·ª£ng, v·∫°n s·ª± nh∆∞ √Ω!",
            "üßß Cung ch√∫c t√¢n xu√¢n, ph√°t t√†i ph√°t l·ªôc!",
            "üèÆ Ch√∫c b·∫°n s·ª©c kh·ªèe d·ªìi d√†o, ti·ªÅn v√†o nh∆∞ n∆∞·ªõc!",
            "üéä NƒÉm m·ªõi ƒë·∫Øc l·ªôc, ƒë·∫Øc t√†i, ƒë·∫Øc b√¨nh an!",
            "üå∏ Ch√∫c b·∫°n v√† gia ƒë√¨nh m·ªôt nƒÉm m·ªõi h·∫°nh ph√∫c, vi√™n m√£n!",
            "üçä L·ªôc ƒë·∫øn nh√† nh√†, xu√¢n sang kh·∫Øp ch·ªën!",
            "üêâ Cung h·ª∑ ph√°t t√†i, v·∫°n s·ª± hanh th√¥ng!"
        ];

        // ========== DATA STRUCTURE ==========
        let DATA = { users: [], gameActive: false, winners: null };
        let currentUser = null;
        let gameActive = false;
        let gamePaused = false;
        let score = 0;
        let timeLeft = 600; // 10 ph√∫t = 600 gi√¢y
        let gameInterval, spawnInterval;
        let objects = [];
        let spawnRate = 500; // T·ªëc ƒë·ªô spawn ban ƒë·∫ßu (ms)

        // ========== CANVAS SETUP ==========
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ========== K·∫æT N·ªêI GITLAB ==========
        async function loadData() {
            try {
                const response = await fetch(`${API}?ref=main`, {
                    headers: { 'Private-Token': TOKEN }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    DATA = JSON.parse(atob(data.content));
                    if (!DATA.users) DATA.users = [];
                    if (!DATA.winners) DATA.winners = null;
                } else {
                    // T·∫°o d·ªØ li·ªáu m·ªõi n·∫øu file ch∆∞a t·ªìn t·∫°i
                    DATA = { users: [], winners: null };
                    await saveData();
                }
            } catch (error) {
                console.error("L·ªói t·∫£i d·ªØ li·ªáu:", error);
                DATA = { users: [], winners: null };
                toast("‚ö†Ô∏è Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß!");
            }
        }

        async function saveData() {
            try {
                const content = btoa(JSON.stringify(DATA, null, 2));
                
                // Ki·ªÉm tra file ƒë√£ t·ªìn t·∫°i ch∆∞a
                const checkResponse = await fetch(`${API}?ref=main`, {
                    headers: { 'Private-Token': TOKEN }
                });

                if (checkResponse.ok) {
                    // File ƒë√£ t·ªìn t·∫°i, c·∫≠p nh·∫≠t
                    const payload = {
                        branch: "main",
                        commit_message: `C·∫≠p nh·∫≠t game - ${new Date().toLocaleString('vi-VN')}`,
                        encoding: "base64",
                        content: content
                    };

                    await fetch(API, {
                        method: 'PUT',
                        headers: { 
                            'Private-Token': TOKEN, 
                            'Content-Type': 'application/json' 
                        },
                        body: JSON.stringify(payload)
                    });
                } else {
                    // File ch∆∞a t·ªìn t·∫°i, t·∫°o m·ªõi
                    const payload = {
                        branch: "main",
                        commit_message: `Kh·ªüi t·∫°o d·ªØ li·ªáu game`,
                        encoding: "base64",
                        content: content
                    };

                    await fetch(API, {
                        method: 'POST',
                        headers: { 
                            'Private-Token': TOKEN, 
                            'Content-Type': 'application/json' 
                        },
                        body: JSON.stringify(payload)
                    });
                }
            } catch (error) {
                console.error("L·ªói l∆∞u d·ªØ li·ªáu:", error);
            }
        }

        // ========== KI·ªÇM TRA TH·ªúI GIAN ==========
        function checkDeadline() {
            const now = Date.now();
            if (now > DEADLINE) {
                document.getElementById('btn-play').disabled = true;
                document.getElementById('btn-play').style.opacity = "0.5";
                document.getElementById('btn-play').innerHTML = '<i class="fas fa-ban"></i> S·ª∞ KI·ªÜN ƒê√É K·∫æT TH√öC';
                return true;
            }
            return false;
        }

        // ========== AUTHENTICATION ==========
        function toggleAuth(showReg) {
            document.getElementById('login-box').style.display = showReg ? 'none' : 'block';
            document.getElementById('reg-box').style.display = showReg ? 'block' : 'none';
        }

        async function handleRegister() {
            const username = document.getElementById('r-user').value.trim();
            const email = document.getElementById('r-email').value.trim();
            const password = document.getElementById('r-pass').value.trim();

            // Validation
            if (!username || !email || !password) {
                toast("‚ùå Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
                return;
            }

            if (username.length < 3) {
                toast("‚ùå T√†i kho·∫£n ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±!");
                return;
            }

            if (!email.includes('@') || !email.includes('.')) {
                toast("‚ùå Email kh√¥ng h·ª£p l·ªá!");
                return;
            }

            if (password.length < 6) {
                toast("‚ùå M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!");
                return;
            }

            if (DATA.users.length >= 50) {
                toast("‚ùå ƒê√£ ƒë·∫°t gi·ªõi h·∫°n 50 t√†i kho·∫£n!");
                return;
            }

            if (DATA.users.find(u => u.username === username)) {
                toast("‚ùå T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!");
                return;
            }

            if (DATA.users.find(u => u.email === email)) {
                toast("‚ùå Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!");
                return;
            }

            // T·∫°o t√†i kho·∫£n m·ªõi
            const newUser = {
                username: username,
                email: email,
                password: password,
                score: 0,
                createdAt: new Date().toISOString()
            };

            DATA.users.push(newUser);
            await saveData();
            
            toast("‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.");
            toggleAuth(false);
            
            // Clear form
            document.getElementById('r-user').value = '';
            document.getElementById('r-email').value = '';
            document.getElementById('r-pass').value = '';
        }

        async function handleLogin() {
            const username = document.getElementById('l-user').value.trim();
            const password = document.getElementById('l-pass').value.trim();
            const rememberMe = document.getElementById('remember-me').checked;

            if (!username || !password) {
                toast("‚ùå Vui l√≤ng nh·∫≠p t√†i kho·∫£n v√† m·∫≠t kh·∫©u!");
                return;
            }

            const user = DATA.users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = user;
                
                // L∆∞u v√†o localStorage n·∫øu ch·ªçn ghi nh·ªõ
                if (rememberMe) {
                    localStorage.setItem('tet2026_remember', 'true');
                    localStorage.setItem('tet2026_username', username);
                    localStorage.setItem('tet2026_password', password);
                } else {
                    localStorage.removeItem('tet2026_remember');
                    localStorage.removeItem('tet2026_username');
                    localStorage.removeItem('tet2026_password');
                }
                
                showScreen('screen-home');
                document.getElementById('user-welcome').textContent = `Ch√†o m·ª´ng, ${username}!`;
                updateHomeStats();
                toast(`üéâ Ch√∫c m·ª´ng nƒÉm m·ªõi ${username}!`);
                
                // Clear login form
                document.getElementById('l-user').value = '';
                document.getElementById('l-pass').value = '';
            } else {
                toast("‚ùå Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
            }
        }

        // Auto login function
        async function autoLogin() {
            const remember = localStorage.getItem('tet2026_remember');
            if (remember === 'true') {
                const username = localStorage.getItem('tet2026_username');
                const password = localStorage.getItem('tet2026_password');
                
                if (username && password) {
                    const user = DATA.users.find(u => u.username === username && u.password === password);
                    if (user) {
                        currentUser = user;
                        showScreen('screen-home');
                        document.getElementById('user-welcome').textContent = `Ch√†o m·ª´ng tr·ªü l·∫°i, ${username}!`;
                        updateHomeStats();
                        toast(`üéâ Ch√†o m·ª´ng ${username} quay l·∫°i!`);
                        return true;
                    }
                }
            }
            return false;
        }

        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('tet2026_remember');
            localStorage.removeItem('tet2026_username');
            localStorage.removeItem('tet2026_password');
            showScreen('screen-welcome');
            toast("üëã H·∫πn g·∫∑p l·∫°i b·∫°n!");
        }

        // Go to auth from welcome
        function goToAuth() {
            showScreen('screen-auth');
        }

        // Show tutorial
        function showTutorial() {
            document.getElementById('modal-tutorial').style.display = 'flex';
        }

        // Fireworks animation
        function createFirework() {
            const colors = ['#FFD700', '#FDB913', '#FFA500', '#FF4500', '#FF1493'];
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = Math.random() * window.innerWidth + 'px';
            firework.style.top = Math.random() * window.innerHeight + 'px';
            firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            firework.style.boxShadow = `0 0 20px ${firework.style.backgroundColor}`;
            document.body.appendChild(firework);
            
            let size = 10;
            let opacity = 1;
            const interval = setInterval(() => {
                size += 5;
                opacity -= 0.02;
                firework.style.width = size + 'px';
                firework.style.height = size + 'px';
                firework.style.opacity = opacity;
                
                if (opacity <= 0) {
                    clearInterval(interval);
                    firework.remove();
                }
            }, 50);
        }

        // ========== GAME CLASSES ==========
        class Fruit {
            constructor(type) {
                this.type = type; // 'fruit', 'bomb', 'gift'
                // N√©m t·ª´ d∆∞·ªõi l√™n, t·∫≠p trung v√†o gi·ªØa m√†n h√¨nh
                this.x = canvas.width / 2 + (Math.random() - 0.5) * 200; // T·∫≠p trung v√†o gi·ªØa
                this.y = canvas.height + 30; // B·∫Øt ƒë·∫ßu t·ª´ d∆∞·ªõi m√†n h√¨nh
                
                // ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô n√©m - v·ª´a ph·∫£i, kh√¥ng qu√° nhanh
                this.vx = (Math.random() - 0.5) * 4; // Gi·∫£m t·ªëc ƒë·ªô ngang
                this.vy = -(Math.random() * 10 + 12); // Gi·∫£m t·ªëc ƒë·ªô bay l√™n
                
                this.radius = type === 'gift' ? 40 : 35;
                this.sliced = false;
                this.rotation = 0;
                this.rotSpeed = (Math.random() - 0.5) * 0.1;
                
                // Emoji v√† m√†u s·∫Øc theo lo·∫°i
                if (type === 'fruit') {
                    const fruits = ['üçé', 'üçä', 'üçá', 'üçâ', 'üçå', 'üçì', 'üçí', 'üçë', 'üçç', 'ü•ù'];
                    this.emoji = fruits[Math.floor(Math.random() * fruits.length)];
                    this.color = '#FF6B6B';
                } else if (type === 'bomb') {
                    this.emoji = 'üí£';
                    this.color = '#4A4A4A';
                } else {
                    this.emoji = 'üéÅ';
                    this.color = '#FDB913';
                }
            }

            update() {
                if (!gamePaused) {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += 0.2; // Gi·∫£m gravity ƒë·ªÉ bay cao h∆°n
                    this.rotation += this.rotSpeed;
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                
                // V·∫Ω b√≥ng
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetY = 5;
                
                // V·∫Ω h√¨nh tr√≤n n·ªÅn
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // V·∫Ω emoji
                ctx.shadowBlur = 0;
                ctx.font = `${this.radius}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.emoji, 0, 0);
                
                ctx.restore();
            }

            isOffscreen() {
                return this.y > canvas.height + 100 || this.x < -100 || this.x > canvas.width + 100 || this.y < -100;
            }
        }

        // ========== GAME FUNCTIONS ==========
        function initCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function startGame() {
            if (checkDeadline()) {
                toast("‚ùå S·ª± ki·ªán ƒë√£ k·∫øt th√∫c!");
                return;
            }

            score = 0;
            timeLeft = 600;
            objects = [];
            gameActive = true;
            gamePaused = false;
            spawnRate = 500; // Reset spawn rate
            
            showScreen('screen-game');
            initCanvas();
            
            document.getElementById('live-score').textContent = '0';
            document.getElementById('live-time').textContent = '10:00';
            document.getElementById('pauseMenu').classList.remove('active');

            // ===== B·∫¨T NH·∫†C N·ªÄN KHI B·∫ÆT ƒê·∫¶U CH√âM =====
            playBackgroundMusic();

            // Game loop
            gameInterval = setInterval(() => {
                if (!gamePaused && gameActive) {
                    timeLeft--;
                    document.getElementById('live-time').textContent = formatTime(timeLeft);
                    
                    // TƒÉng ƒë·ªô kh√≥ theo th·ªùi gian
                    if (timeLeft <= 480) { // T·ª´ 8 ph√∫t tr·ªü ƒëi (c√≤n 8 ph√∫t = 480 gi√¢y)
                        spawnRate = 400; // N√©m nhanh h∆°n
                        if (timeLeft <= 300) { // 5 ph√∫t cu·ªëi
                            spawnRate = 350;
                        }
                        if (timeLeft <= 120) { // 2 ph√∫t cu·ªëi
                            spawnRate = 300;
                        }
                    }
                    
                    if (timeLeft <= 0) {
                        endGame('timeout');
                    }
                }
            }, 1000);

            // Spawn objects
            spawnInterval = setInterval(() => {
                if (!gameActive || gamePaused) return;
                
                // S·ªë l∆∞·ª£ng objects m·ªói l·∫ßn spawn
                let count = 1;
                if (timeLeft <= 480) count = 2; // T·ª´ 8 ph√∫t: spawn 2 qu·∫£
                if (timeLeft <= 300) count = 3; // T·ª´ 5 ph√∫t: spawn 3 qu·∫£
                if (timeLeft <= 120) count = 4; // T·ª´ 2 ph√∫t: spawn 4 qu·∫£
                
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        if (!gameActive || gamePaused) return;
                        
                        const rand = Math.random();
                        let type = 'fruit';
                        
                        // TƒÉng ƒë·ªô kh√≥ theo th·ªùi gian
                        if (timeLeft <= 480) { // T·ª´ 8 ph√∫t
                            if (rand < 0.3) type = 'bomb';
                            else if (rand < 0.35) type = 'gift';
                        } else {
                            if (rand < 0.15) type = 'bomb';
                            else if (rand < 0.18) type = 'gift';
                        }
                        
                        objects.push(new Fruit(type));
                    }, i * 100); // Delay gi·ªØa c√°c objects
                }
            }, spawnRate);

            requestAnimationFrame(gameLoop);
        }

        function gameLoop() {
            if (!gameActive) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // V·∫Ω hi·ªáu ·ª©ng n·ªÅn
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // V·∫Ω v√πng trung t√¢m ƒë·ªÉ ng∆∞·ªùi ch∆°i d·ªÖ nh·∫Øm
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 50, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(253, 185, 19, 0.3)';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Update v√† v·∫Ω objects
            for (let i = objects.length - 1; i >= 0; i--) {
                const obj = objects[i];
                obj.update();
                obj.draw();
                
                if (obj.isOffscreen()) {
                    objects.splice(i, 1);
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        function handleSlice(x, y) {
            if (!gameActive || gamePaused) return;
            
            for (let i = objects.length - 1; i >= 0; i--) {
                const obj = objects[i];
                const dist = Math.hypot(obj.x - x, obj.y - y);
                
                if (dist < obj.radius && !obj.sliced) {
                    obj.sliced = true;
                    
                    // X·ª≠ l√Ω theo lo·∫°i
                    if (obj.type === 'fruit') {
                        score += 5;
                        playSliceSound('fruit');
                        createSliceEffect(x, y, '#4CAF50');
                    } else if (obj.type === 'bomb') {
                        score = Math.max(0, score - 10);
                        playSliceSound('bomb');
                        createSliceEffect(x, y, '#F44336');
                    } else if (obj.type === 'gift') {
                        playSliceSound('gift');
                        const wish = TET_WISHES[Math.floor(Math.random() * TET_WISHES.length)];
                        toast(`üéÅ ${wish}`);
                        endGame('gift');
                    }
                    
                    document.getElementById('live-score').textContent = score;
                    objects.splice(i, 1);
                }
            }
        }

        function createSliceEffect(x, y, color) {
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    if (!gameActive) return;
                    ctx.beginPath();
                    ctx.arc(x, y, 3 + i * 2, 0, Math.PI * 2);
                    ctx.fillStyle = color + (80 - i * 10).toString(16);
                    ctx.fill();
                }, i * 30);
            }
        }

        function togglePause() {
            if (!gameActive) return;
            
            gamePaused = !gamePaused;
            if (gamePaused) {
                document.getElementById('pause-score').textContent = score;
                document.getElementById('pauseMenu').classList.add('active');
                if (soundEnabled) bgMusic.pause(); // T·∫°m d·ª´ng nh·∫°c khi pause game
            } else {
                document.getElementById('pauseMenu').classList.remove('active');
                if (soundEnabled) {
                    playBackgroundMusic(); // Ti·∫øp t·ª•c nh·∫°c khi resume game
                }
            }
        }

        function resumeGame() {
            gamePaused = false;
            document.getElementById('pauseMenu').classList.remove('active');
            if (soundEnabled) {
                playBackgroundMusic(); // Ti·∫øp t·ª•c nh·∫°c khi resume game
            }
        }

        async function quitGame() {
            gamePaused = false;
            document.getElementById('pauseMenu').classList.remove('active');
            await endGame('quit');
        }

        async function endGame(reason) {
            gameActive = false;
            clearInterval(gameInterval);
            clearInterval(spawnInterval);
            
            // ===== T·∫ÆT NH·∫†C N·ªÄN KHI K·∫æT TH√öC GAME =====
            stopBackgroundMusic();
            
            let message = '';
            if (reason === 'timeout') {
                message = `‚è∞ H·∫øt gi·ªù! B·∫°n ƒë√£ ch√©m ƒë∆∞·ª£c ${score} ƒëi·ªÉm.`;
                if (soundEnabled) playLoseSound();
            } else if (reason === 'gift') {
                message = `üéÅ B·∫°n ƒë√£ ch√©m tr√∫ng h·ªôp qu√†!`;
                if (soundEnabled) {
                    giftSound.currentTime = 0;
                    giftSound.play();
                }
            } else if (reason === 'quit') {
                message = `üõë B·∫°n ƒë√£ d·ª´ng cu·ªôc ch∆°i! ƒêi·ªÉm s·ªë: ${score}`;
                if (soundEnabled) playLoseSound();
            }
            
            document.getElementById('final-score').textContent = score;
            document.getElementById('game-over-message').textContent = message;
            document.getElementById('gameOverScreen').style.display = 'block';
            
            // C·∫≠p nh·∫≠t ƒëi·ªÉm cao nh·∫•t
            if (score > currentUser.score) {
                currentUser.score = score;
                await saveData();
            }
            
            // Ki·ªÉm tra v√† c√¥ng b·ªë ng∆∞·ªùi th·∫Øng cu·ªôc n·∫øu ƒë√£ h·∫øt h·∫°n
            if (Date.now() > DEADLINE && !DATA.winners) {
                await declareWinners();
            }
        }

        function backToHome() {
            document.getElementById('gameOverScreen').style.display = 'none';
            showScreen('screen-home');
            updateHomeStats();
        }

        async function declareWinners() {
            const sorted = [...DATA.users].sort((a, b) => b.score - a.score);
            DATA.winners = {
                first: sorted[0]?.username,
                second: sorted[1]?.username,
                third: sorted[2]?.username,
                announcedAt: new Date().toISOString()
            };
            await saveData();
        }

        // ========== UI FUNCTIONS ==========
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // X·ª≠ l√Ω nh·∫°c n·ªÅn khi chuy·ªÉn m√†n h√¨nh
            if (id !== 'screen-game') {
                // N·∫øu kh√¥ng ph·∫£i m√†n h√¨nh game, ƒë·∫£m b·∫£o nh·∫°c ƒë√£ t·∫Øt
                bgMusic.pause();
                bgMusic.currentTime = 0;
            }
        }

        function toast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateHomeStats() {
            if (!currentUser) return;
            
            document.getElementById('my-score').textContent = currentUser.score;
            
            const sorted = [...DATA.users].sort((a, b) => b.score - a.score);
            const rank = sorted.findIndex(u => u.username === currentUser.username) + 1;
            document.getElementById('my-rank').textContent = rank || '--';
        }

        function showLeaderboard() {
            const list = document.getElementById('rank-list');
            list.innerHTML = '';
            
            const sorted = [...DATA.users].sort((a, b) => b.score - a.score);
            
            sorted.forEach((user, index) => {
                const isTop = index < 3;
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üéØ';
                
                const item = document.createElement('div');
                item.className = `rank-item ${isTop ? 'rank-gold' : ''}`;
                item.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span class="rank-number">${medal}</span>
                        <span style="font-weight: 600;">${user.username}</span>
                    </div>
                    <span style="font-weight: 700; color: var(--gold);">${user.score}ƒë</span>
                `;
                
                list.appendChild(item);
            });
            
            document.getElementById('modal-rank').style.display = 'flex';
        }

        function checkReward() {
            if (Date.now() <= DEADLINE) {
                toast("‚è∞ Ch·ªù ƒë·∫øn 18/02/2026 ƒë·ªÉ c√¥ng b·ªë k·∫øt qu·∫£!");
                return;
            }
            
            if (!DATA.winners) {
                toast("‚è∞ ƒêang t·ªïng k·∫øt k·∫øt qu·∫£, vui l√≤ng th·ª≠ l·∫°i sau!");
                return;
            }
            
            const sorted = [...DATA.users].sort((a, b) => b.score - a.score);
            const rank = sorted.findIndex(u => u.username === currentUser.username) + 1;
            
            let content = '';
            let title = 'üéÅ K·∫æT QU·∫¢';
            
            if (rank === 1 && DATA.winners.first === currentUser.username) {
                title = 'üèÜ GI·∫¢I NH·∫§T üèÜ';
                content = `
                    <div style="text-align: center;">
                        <p style="font-size: 3rem;">ü•á</p>
                        <h3 style="color: var(--gold);">CAPCUT PRO 35 NG√ÄY</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <p><strong>T√†i kho·∫£n:</strong> lucindahil@theory.mailbo.store</p>
                            <p><strong>M·∫≠t kh·∫©u:</strong> 999999</p>
                        </div>
                        <p style="margin-top: 15px;">üéã Ch√∫c m·ª´ng nƒÉm m·ªõi! S·ª≠ d·ª•ng ngay ƒë·ªÉ t·∫°o video T·∫øt.</p>
                    </div>
                `;
            } else if (rank === 2 && DATA.winners.second === currentUser.username) {
                title = 'ü•à GI·∫¢I NH√å ü•à';
                content = `
                    <div style="text-align: center;">
                        <p style="font-size: 3rem;">ü•à</p>
                        <h3 style="color: var(--gold);">CAPCUT PRO 14 NG√ÄY</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <p><strong>T√†i kho·∫£n:</strong> abelardo.kunmlibp053@skibolaservices.com</p>
                            <p><strong>M·∫≠t kh·∫©u:</strong> hung@1234</p>
                        </div>
                        <p style="margin-top: 15px;">üßß Ch√∫c b·∫°n c√≥ nh·ªØng video T·∫øt th·∫≠t ƒë·∫πp!</p>
                    </div>
                `;
            } else if (rank === 3 && DATA.winners.third === currentUser.username) {
                title = 'ü•â GI·∫¢I BA ü•â';
                content = `
                    <div style="text-align: center;">
                        <p style="font-size: 3rem;">ü•â</p>
                        <h3 style="color: var(--gold);">CAPCUT PRO 14 NG√ÄY</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <p><strong>T√†i kho·∫£n:</strong> felicia_schimlibp03s@aenhatao.com</p>
                            <p><strong>M·∫≠t kh·∫©u:</strong> hung@1234</p>
                        </div>
                        <p style="margin-top: 15px;">üå∏ Ch√∫c m·ª´ng b·∫°n ƒë√£ chi·∫øn th·∫Øng!</p>
                    </div>
                `;
            } else {
                content = `
                    <div style="text-align: center;">
                        <p style="font-size: 2rem;">üéã</p>
                        <h3 style="color: var(--gold);">CH√öC M·ª™NG NƒÇM M·ªöI</h3>
                        <p>R·∫•t ti·∫øc, b·∫°n ch∆∞a l·ªçt v√†o Top 3.</p>
                        <p style="margin-top: 15px; font-style: italic;">H·∫πn g·∫∑p l·∫°i b·∫°n trong nƒÉm t·ªõi!</p>
                    </div>
                `;
            }
            
            document.getElementById('reward-title').textContent = title;
            document.getElementById('reward-content').innerHTML = content;
            document.getElementById('modal-reward').style.display = 'flex';
        }

        // ========== EVENT LISTENERS ==========
        canvas.addEventListener('mousemove', (e) => {
            handleSlice(e.clientX, e.clientY);
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (e.touches.length > 0) {
                handleSlice(e.touches[0].clientX, e.touches[0].clientY);
            }
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (e.touches.length > 0) {
                handleSlice(e.touches[0].clientX, e.touches[0].clientY);
            }
        });

        window.addEventListener('resize', () => {
            if (gameActive) {
                initCanvas();
            }
        });

        // Ph√≠m ESC ƒë·ªÉ pause
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && gameActive) {
                togglePause();
            }
        });

        // Countdown timer
        setInterval(() => {
            const now = Date.now();
            const diff = DEADLINE - now;
            
            if (diff <= 0) {
                document.getElementById('countdown-timer').innerHTML = "üéâ CH·ªêT K·∫æT QU·∫¢ üéâ";
                checkDeadline();
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('countdown-timer').innerHTML = 
                `${days} ng√†y ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);

        // Fireworks animation (every 2 seconds on welcome screen)
        setInterval(() => {
            if (document.getElementById('screen-welcome').classList.contains('active')) {
                createFirework();
            }
        }, 2000);

        // ========== INITIALIZATION ==========
        window.onload = async () => {
            await loadData();
            
            // Ki·ªÉm tra deadline
            if (Date.now() > DEADLINE) {
                await declareWinners();
            }
            
            // Hi·ªÉn th·ªã l·ªùi ch√∫c ng·∫´u nhi√™n tr√™n m√†n h√¨nh welcome
            const randomWish = TET_WISHES[Math.floor(Math.random() * TET_WISHES.length)];
            document.getElementById('welcome-wish').textContent = randomWish;
            
            // Ki·ªÉm tra xem c√≥ auto login kh√¥ng
            const autoLoggedIn = await autoLogin();
            
            if (!autoLoggedIn) {
                // Hi·ªáu ·ª©ng loading
                setTimeout(() => {
                    showScreen('screen-welcome');
                }, 3000);
            }
        };
    </script>
</body>
</html>